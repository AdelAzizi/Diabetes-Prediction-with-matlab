# ุชูุถุญ ูุงู `evaluate_model.m`

ุงู ุชุงุจุน ูุณุฆูู **ุงุฑุฒุงุจ ููุง ู ุชุฎุตุต ูุฏู** ุงุณุช.  
ูู ุชููุง ุฏูุช (Accuracy) ุฑุง ูุญุงุณุจู ูโฺฉูุฏุ ุจูฺฉู ูุนุงุฑูุง ูพุฒุดฺฉ ููู ูุซู Sensitivityุ Precisionุ Specificity ู F1-Score ุฑุง ูู ุญุณุงุจ ูโฺฉูุฏ ู ูููุฏุงุฑูุง ุชุฎุตุต ูุซู ROC Curve ู Confusion Matrix ุฑุง ุฑุณู ูโฺฉูุฏ. ููฺูู ุดุงูู ุจุงุฒุฑุณ ูู ูุฏู ู ุชุญูู ููุดููุฏ ูุชุงุฌ ุงุณุช.

---

## ูุฑูุฏ ู ุฎุฑูุฌ

- **ูุฑูุฏโูุง:**
  - `model`: ูุฏู ุขููุฒุด ุฏุฏู (ูุซูุงู ุงุฒ `fitcknn` ุง `fitctree`)
  - `X_test`: ุฏุงุฏูโูุง ุชุณุช (ูฺฺฏโูุง)
  - `Y_test`: ุจุฑฺุณุจโูุง ูุงูุน ุชุณุช (ุฌูุงุจ ุฏุฑุณุช)
- **ุฎุฑูุฌ:**  
  - ุฎุฑูุฌ ูุณุชูู (ูุชุบุฑ) ุจุฑููโฺฏุฑุฏุงูุฏุ ุงูุง ูุชุงุฌ ุฑุง ุฏุฑ ูพูุฌุฑู ฺฉุงููุฏ ููุงุด ูโุฏูุฏ ู ูููุฏุงุฑูุง ุฑุง ุฑุณู ูโฺฉูุฏ.

---

## ูุฑุญููโุจูโูุฑุญูู ฺู ฺฉุงุฑ ูโฺฉูุฏุ

### ฑ. ุจุงุฒุฑุณ ูู ูุฏู
ุจุฑุฑุณ ูโฺฉูุฏ ฺฉู ุขุง ูุฏู ุงุฒ ููุน Ensemble ุงุณุช ู ฺู ุชุนุฏุงุฏ ุฏุฑุฎุช ุฏุงุฑุฏ (NumTrained). ุงู ุงุทูุงุนุงุช ุจุฑุง ุชุดุฎุต ูุฏู ุชูู ุดุฏู ุง ุงุณุชุงูุฏุงุฑุฏ ููุฑุฏ ุงุณุชูุงุฏู ูุฑุงุฑ ูโฺฏุฑุฏ.

### ฒ. ูพุดโุจู
ูุฏู ุฑู ุฏุงุฏูโูุง ุชุณุช ูพุดโุจู ูโฺฉูุฏ ู ูู ฺฉูุงุณ (ฐ ุง ฑ) ู ูู ุงุญุชูุงู (Score) ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ.

### ณ. ูุญุงุณุจู ูุงุชุฑุณ ุฎุทุง (Confusion Matrix)
ุงุฒ ุฑู ูพุดโุจูโูุง ู ุฌูุงุจโูุง ูุงูุนุ ฺฉ ูุงุชุฑุณ ฒรฒ ุณุงุฎุชู ูโุดูุฏ ฺฉู ูโฺฏูุฏ:
- ฺูุฏ ุชุง ุณุงูู ุฏุฑุณุช ุชุดุฎุต ุฏุงุฏู ุดุฏ (TN)
- ฺูุฏ ุชุง ุณุงูู ุงุดุชุจุงู ุชุดุฎุต ุฏุงุฏู ุดุฏ (FP)
- ฺูุฏ ุชุง ุจูุงุฑ ุงุดุชุจุงู ุชุดุฎุต ุฏุงุฏู ุดุฏ (FN)
- ฺูุฏ ุชุง ุจูุงุฑ ุฏุฑุณุช ุชุดุฎุต ุฏุงุฏู ุดุฏ (TP)

### ด. ูุญุงุณุจู ูุนุงุฑูุง ูุฎุชูู
- **Accuracy**: ุฏูุช ฺฉู
- **Sensitivity**: ูุฏุฑุช ฺฉุดู ุจูุงุฑุงู (ููุงู Recall)
- **Precision**: ููุช ูโฺฏูุฏ ุจูุงุฑ ุงุณุชุ ฺูุฏุฑ ุงุญุชูุงู ุฏุงุฑุฏ ูุงูุนุงู ุจูุงุฑ ุจุงุดุฏ
- **Specificity**: ูุฏุฑุช ุชุดุฎุต ุณุงููโูุง
- **F1-Score**: ูุงูฺฏู ูุงุฑูููฺฉ Precision ู Sensitivity
- **AUC Score**: ูุณุงุญุช ุฒุฑ ููุญู ROC

### ต. ููุงุด ฺฏุฒุงุฑุด ูุชู
ููู ูุนุงุฑูุง ุจู ุตูุฑุช ุฌุฏูู ุฏุฑ ูพูุฌุฑู ฺฉุงููุฏ ููุงุด ุฏุงุฏู ูโุดููุฏ.

### ถ. ุชุญูู ููุดููุฏ ูุชุงุฌ
ุชุญูู ููุดููุฏ ุจุฑุง ุฏุฑฺฉ ฺุฑุง ุซุงุจุช ูุงูุฏู ุฏูุช ููุง ุฏุฑ ุญุงู ฺฉู ุชุนุฏุงุฏ ุฏุฑุฎุชโูุง ุชุบุฑ ฺฉุฑุฏู ุงุณุชุ ุงุฑุงุฆู ูโุดูุฏ. ุงู ุชุญูู ูุดุงู ูโุฏูุฏ ฺฉู ุชุบุฑุงุช ูพุงุฑุงูุชุฑูุง ุฑู "ุงุญุชูุงู" (Score) ุชุงุซุฑ ฺฏุฐุงุดุชู ุงูุง ุขููุฏุฑ ุจุฒุฑฺฏ ูุจูุฏู ฺฉู ุจุฑฺุณุจ (0 ุง 1) ูููููโูุง ูุฑุฒ ุฑุง ุนูุถ ฺฉูุฏ.

### ท. ุฑุณู ูููุฏุงุฑูุง
- **Confusion Matrix**: ูุงุชุฑุณ ุฎุทุง ุจู ุตูุฑุช ุจุตุฑ
- **ROC Curve**: ูููุฏุงุฑ ุนููฺฉุฑุฏ ูุฏู ุฏุฑ ุขุณุชุงููโูุง ูุฎุชูู

---

## ุชูุถุญ ุฎุท ุจู ุฎุท ฺฉุฏ

```matlab
function evaluate_model(model, X_test, Y_test)
```
**ุฎุท ฑ:** ุชุนุฑู ุชุงุจุน. ุณู ูุฑูุฏ ูโฺฏุฑุฏ ู ุฎุฑูุฌ ุจุฑููโฺฏุฑุฏุงูุฏ.

```matlab
    % EVALUATE_MODEL ูุณุฎู ููุง ู ุจุฏูู ุฎุทุง
    
    disp(' ');
    disp('=======================================================');
    disp('๐ ูุฑุญูู ถ: ุงุฑุฒุงุจ ููุง ู ุชุฎุตุต (Final Evaluation)');
    disp('=======================================================');
```
**ุฎุท ฒ-ท:** ฺฉุงููุช ุชูุถุญ ู ููุงุด ุนููุงู ูุฑุญูู.

```matlab
    %% ฑ. ุจุงุฒุฑุณ ูู ูุฏู (ุจุฏูู ุฏุณุชฺฉุงุฑโูุง ุฎุทุฑูุงฺฉ)
    disp('๐ต๏ธโโ๏ธ ุจุงุฒุฑุณ ูุฏู:');
    
    if isa(model, 'classreg.learning.classif.ClassificationEnsemble')
        % ุชุนุฏุงุฏ ุฏุฑุฎุชโูุง ุงููโุชุฑู ุฑุงู ุชุดุฎุต ูุฏู ุฌุฏุฏ ุงุณุช
        nTrees = model.NumTrained;
        
        fprintf('   - ุชุนุฏุงุฏ ุฏุฑุฎุชโูุง ูุฏู ูุนู: %d\n', nTrees);
        
        if nTrees ~= 100
            disp('   โ ุชุงุฏ ุดุฏ: ูุฏู ุชูู ุดุฏู ุจุงุฑฺฏุฐุงุฑ ุดุฏู ุงุณุช.');
            disp('      (ฺูู ุชุนุฏุงุฏ ุฏุฑุฎุชโูุง ูพุดโูุฑุถ ููุดู ฑฐ ุงุณุช)');
        else
            disp('   โ๏ธ ูุฏู ุดุจู ุญุงูุช ูพุดโูุฑุถ ุงุณุช.');
        end
    else
        disp('   - ูุฏู ุงุฒ ููุน Ensemble ูุณุช.');
    end
    disp('-------------------------------------------------------');

    %% ฒ. ูพุดโุจู
    [Y_pred, scores] = predict(model, X_test);
```
**ุฎุท น-ฒท:**
- `isa` ุจุฑุฑุณ ูโฺฉูุฏ ฺฉู ุขุง ูุฏู ุงุฒ ููุน ClassificationEnsemble ุงุณุช ุง ุฎุฑ.
- `model.NumTrained` ุชุนุฏุงุฏ ุฏุฑุฎุชโูุง ูุฏู ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ.
- ุงฺฏุฑ ุชุนุฏุงุฏ ุฏุฑุฎุชโูุง ฑฐฐ ูุจุงุดุฏุ ุนู ูุฏู ุชูู ุดุฏู ุงุณุช (ฺูู ฑฐฐ ุชุนุฏุงุฏ ูพุดโูุฑุถ ุงุณุช).
- `predict` ูุฏู ุฑุง ุฑู ุฏุงุฏูโูุง ุชุณุช ุงุฌุฑุง ูโฺฉูุฏ.
- `Y_pred` ูพุดโุจู ฺฉูุงุณโูุง ุงุณุช (ฐ ุง ฑ).
- `scores` ุงุญุชูุงู ุชุนูู ุจู ูุฑ ฺฉูุงุณ ุงุณุช (ูุซูุงู [0.3, 0.7] ุนู ณฐูช ุงุญุชูุงู ุณุงูู ู ทฐูช ุงุญุชูุงู ุจูุงุฑ).

```matlab
    cm = confusionmat(Y_test, Y_pred);
```
**ุฎุท ณฑ-ณฒ:**
- `confusionmat` ูุงุชุฑุณ ุฎุทุง ุฑุง ูุญุงุณุจู ูโฺฉูุฏ.
- `cm` ฺฉ ูุงุชุฑุณ ฒรฒ ุงุณุช.

```matlab
    TN = cm(1,1); FP = cm(1,2);
    FN = cm(2,1); TP = cm(2,2);
```
**ุฎุท ณณ-ณด:**
- `TN` (True Negative): ุณุงูู ุฏุฑุณุช ุชุดุฎุต ุฏุงุฏู ุดุฏ.
- `FP` (False Positive): ุณุงูู ุงุดุชุจุงู ุชุดุฎุต ุฏุงุฏู ุดุฏ (ูุดุฏุงุฑ ุบูุท).
- `FN` (False Negative): ุจูุงุฑ ุงุดุชุจุงู ุชุดุฎุต ุฏุงุฏู ุดุฏ (ุฎุทุฑูุงฺฉ! ฺูู ุจูุงุฑ ุฑุง ุณุงูู ุชุดุฎุต ุฏุงุฏู).
- `TP` (True Positive): ุจูุงุฑ ุฏุฑุณุช ุชุดุฎุต ุฏุงุฏู ุดุฏ.

```matlab
    %% ณ. ูุญุงุณุจุงุช ุฏูู
    accuracy    = (TP + TN) / sum(cm(:));
    sensitivity = TP / (TP + FN);
    specificity = TN / (TN + FP);
    precision   = TP / (TP + FP);
    f1_score    = 2 * (precision * sensitivity) / (precision + sensitivity);
    
    % ูุญุงุณุจู AUC ุจุง ุฏูุช ุจุงูุง
    [~, ~, ~, AUC] = perfcurve(Y_test, scores(:,2), 1);
```
**ุฎุท ณถ-ดด:**
- `accuracy` ุฏูุช ฺฉู ุฑุง ูุญุงุณุจู ูโฺฉูุฏ.
- `sensitivity` (ููุงู recall) ูุฏุฑุช ฺฉุดู ุจูุงุฑุงู ุฑุง ูโุณูุฌุฏ (TP / (TP + FN)).
- `specificity` ูุฏุฑุช ุชุดุฎุต ุณุงููโูุง ุฑุง ูโุณูุฌุฏ (TN / (TN + FP)).
- `precision` ุฏูุช ูพุดโุจู ูุซุจุช ุฑุง ูโุณูุฌุฏ (TP / (TP + FP)).
- `f1_score` ูุงูฺฏู ูุงุฑูููฺฉ precision ู sensitivity ุงุณุช.
- `perfcurve` ุจุฑุง ูุญุงุณุจู AUC (ูุณุงุญุช ุฒุฑ ููุญู ROC) ุงุณุชูุงุฏู ูโุดูุฏ.

```matlab
    %% ด. ููุงุด ูุชุงุฌ ุฏุฑ ุฌุฏูู
    fprintf('\n๐ ูุชุงุฌ ุฏูู ุฑู ุฏุงุฏูโูุง ุชุณุช:\n');
    fprintf('--------------------------------------\n');
    fprintf('| %-20s | %-10s |\n', 'Metric', 'Value');
    fprintf('--------------------------------------\n');
    fprintf('| %-20s | %6.2f%%    |\n', 'Accuracy', accuracy*100);
    fprintf('| %-20s | %6.2f%%    |\n', 'Sensitivity', sensitivity*100);
    fprintf('| %-20s | %6.2f%%    |\n', 'Specificity', specificity*100);
    fprintf('| %-20s | %6.2f%%    |\n', 'F1-Score', f1_score*100);
    fprintf('| %-20s | %6.4f     |\n', 'AUC Score', AUC);
    fprintf('--------------------------------------\n');
```
**ุฎุท ดถ-ตถ:**
- ฺฉ ุฌุฏูู ุจุง ุฏู ุณุชูู ูโุณุงุฒุฏ: "Metric" ู "Value".
- `%-20s` ุนู ฺฉ ุฑุดุชู ุจุง ุนุฑุถ ฒฐ ฺฉุงุฑุงฺฉุชุฑ ู ุชุฑุงุฒ ฺูพ.
- `accuracy*100` ุฏูุช ุฑุง ุฏุฑ ุตุฏ ูโฺฉูุฏ.
- `sensitivity` ุจู ุฌุง recall ุงุณุชูุงุฏู ุดุฏู ุงุณุช.
- `AUC` ุจู ุตูุฑุช ด ุฑูู ุงุนุดุงุฑ ููุงุด ุฏุงุฏู ูโุดูุฏ (ูู ุฏุฑุตุฏ).

```matlab
    %% ต. ุชุญูู ููุง (ฺุฑุง ูุชุฌู ุชุบุฑ ูฺฉุฑุฏุ)
    % ุงฺฏุฑ ุฎุฑูุฌ ุงู ุจุฎุด ฺุงูพ ุดุฏุ ุนู ูุฏู ุนูุถ ุดุฏู ูู ุงุนุฏุงุฏ ููุง ฺฉ ูุณุชูุฏ
    if nTrees ~= 100 && accuracy == 0.7696 % (ุฏูุช ูุจู ุดูุง)
         disp('๐ก ุชุญูู ููุดููุฏ:');
         disp('   ุชุนุฏุงุฏ ุฏุฑุฎุชโูุง ุชุบุฑ ฺฉุฑุฏู (57) ุงูุง ุฏูุช ููุง ุซุงุจุช ูุงูุฏู ุงุณุช.');
         disp('   ุฏูู: ุชุบุฑุงุช ูพุงุฑุงูุชุฑูุง ุฑู "ุงุญุชูุงู" (Score) ุชุงุซุฑ ฺฏุฐุงุดุชู ุงูุง');
         disp('   ุงู ุชุบุฑ ุขููุฏุฑ ุจุฒุฑฺฏ ูุจูุฏู ฺฉู ุจุฑฺุณุจ (0 ุง 1) ูููููโูุง ูุฑุฒ ุฑุง ุนูุถ ฺฉูุฏ.');
         disp('   (ุจู ุชุบุฑุงุช ุฑุฒ ุฏุฑ ููุฏุงุฑ AUC ุฏูุช ฺฉูุฏ).');
    end

    %% ถ. ุฑุณู ู ุฐุฎุฑู ูููุฏุงุฑ
    fig = figure('Name', 'Final Results', 'Color', 'w', 'Position', [100, 100, 1000, 450]);
    
    % Confusion Matrix
    subplot(1, 2, 1);
    confusionchart(cm, {'Healthy', 'Diabetic'});
    title(sprintf('Confusion Matrix (Acc: %.1f%%)', accuracy*100));
    
    % ROC Curve
    subplot(1, 2, 2);
    [Xroc, Yroc] = perfcurve(Y_test, scores(:,2), 1);
    plot(Xroc, Yroc, 'b-', 'LineWidth', 2); hold on;
    plot([0,1], [0,1], 'k--');
    fill([Xroc; 1; 0], [Yroc; 0; 0], 'b', 'FaceAlpha', 0.1, 'EdgeColor', 'none');
    grid on;
    title(sprintf('ROC Curve (AUC = %.4f)', AUC));
    xlabel('False Positive Rate'); ylabel('True Positive Rate');
```
**ุฎุท ตธ-ธถ:**
- ุชุญูู ููุดููุฏ ุจุฑุง ุฏุฑฺฉ ฺุฑุง ุซุงุจุช ูุงูุฏู ุฏูุช ููุง ุฏุฑ ุญุงู ฺฉู ุชุนุฏุงุฏ ุฏุฑุฎุชโูุง ุชุบุฑ ฺฉุฑุฏู ุงุณุช.
- `nTrees ~= 100` ฺฺฉ ูโฺฉูุฏ ฺฉู ุขุง ูุฏู ุชูู ุดุฏู ุงุณุช ุง ุฎุฑ.
- `fig` ฺฉ ูพูุฌุฑู ุฌุฏุฏ ุจุง ุงุจุนุงุฏ ฑฐฐฐรดตฐ ูโุณุงุฒุฏ.
- `confusionchart` ูุงุชุฑุณ ุฎุทุง ุฑุง ุฑุณู ูโฺฉูุฏ.
- `perfcurve` ููุงุท ROC ุฑุง ูุญุงุณุจู ูโฺฉูุฏ.
- `plot` ููุญู ROC ุฑุง ุฑุณู ูโฺฉูุฏ ู ุฎุท ุชุตุงุฏู ุฑุง ุงุถุงูู ูโฺฉูุฏ.
- `fill` ูุงุญู ุฒุฑ ููุญู ROC ุฑุง ุฑูฺฏ ูโฺฉูุฏ.
- `title` ุนููุงู ูููุฏุงุฑ ROC ุฑุง ุจุง ููุฏุงุฑ AUC ุชูุธู ูโฺฉูุฏ.

```matlab
end
```
**ุฎุท ธถ:** ูพุงุงู ุชุงุจุน.

---

## ฺุฑุง ุงู ูุนุงุฑูุง ููู ูุณุชูุฏุ

ุฏุฑ ูพุฒุดฺฉุ ููู ูุนุงุฑูุง ููู ูุณุชูุฏ:

- **Accuracy** ุฎูุจ ุงุณุช ุงูุง ฺฉุงู ูุณุช (ูุซูุงู ุงฺฏุฑ ููู ุฑุง ุณุงูู ุชุดุฎุต ุฏููุ ุจุงุฒ ูู ถตูช ุฏูุช ุฏุงุฑู!).
- **Sensitivity** ููู ุงุณุช ฺูู ููโุฎูุงูู ุจูุงุฑ ุฑุง ุงุฒ ุฏุณุช ุจุฏูู.
- **Precision** ููู ุงุณุช ฺูู ููโุฎูุงูู ุจู ุงูุฑุงุฏ ุณุงูู ุจฺฏูู ุจูุงุฑ ูุณุชูุฏ.
- **F1-Score** ุชุนุงุฏู ุจู ุงู ุฏู ุฑุง ูโุณูุฌุฏ.
- **ROC Curve** ูุดุงู ูโุฏูุฏ ูุฏู ุฏุฑ ุขุณุชุงููโูุง ูุฎุชูู ฺูุฏุฑ ุฎูุจ ุนูู ูโฺฉูุฏ.
