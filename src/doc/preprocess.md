# توضیح فایل `preprocess.m`

این تابع مسئول **تمیز کردن داده‌ها، حذف ویژگی‌های ضعیف، نرمال‌سازی آن‌ها و تقسیم به آموزش/تست** است.  
یعنی داده‌ی خام را به داده‌ای تبدیل می‌کند که یک مدل یادگیری ماشین بتواند راحت و درست با آن کار کند.

---

## ورودی و خروجی

- **ورودی (`data`)**: جدول داده‌ها که از `load_data.m` گرفته می‌شود.
- **خروجی‌ها:**
  - `X_train`, `Y_train`: داده‌ها و برچسب‌ها برای آموزش مدل
  - `X_test`, `Y_test`: داده‌ها و برچسب‌ها برای تست و ارزیابی

---

## مرحله‌به‌مرحله چه کار می‌کند؟

### ۱. انتخاب ویژگی (Feature Selection)
بر اساس تحلیل داده‌ها (EDA)، ویژگی‌های ضعیف که رابطه کمی با بیماری دارند حذف می‌شوند تا نویز کمتر شود.

### ۲. مدیریت مقادیر صفر غیرمنطقی
در بعضی ستون‌ها (مثل قند خون و BMI)، مقدار ۰ از نظر پزشکی منطقی نیست و در این دیتاست معمولاً یعنی «اطلاعات ثبت نشده». این صفرها با میانه (Median) جایگزین می‌شوند (نه میانگین) چون میانه در برابر داده‌های پرت مقاوم‌تر است.

### ۳. جدا کردن ویژگی‌ها (`X`) و برچسب (`Y`)
ستون آخر (`Outcome`) که نشان می‌دهد فرد دیابت دارد (۱) یا ندارد (۰) از بقیه ستون‌ها جدا می‌شود.

### ۴. نرمال‌سازی داده‌ها
همه ویژگی‌ها به یک مقیاس تبدیل می‌شوند تا مدل گیج نشود.

### ۵. تقسیم داده‌ها به آموزش و تست
داده‌ها به دو بخش تقسیم می‌شوند: ۷۰٪ برای آموزش و ۳۰٪ برای تست.

---

## توضیح خط به خط کد

```matlab
function [X_train, Y_train, X_test, Y_test] = preprocess(data)
```
**خط ۱:** تعریف تابع. نام تابع `preprocess` است. یک ورودی (`data`) می‌گیرد و چهار خروجی برمی‌گرداند.

```matlab
    % PREPROCESS نسخه حرفه‌ای (Smart Version)
    % بر اساس نتایج تحلیل داده‌ها (EDA)
    
    disp('... در حال پیش‌پردازش هوشمند (Smart Preprocessing) ...');
```
**خط ۲-۵:** کامنت‌های توضیحی و نمایش پیغام شروع کار.

```matlab
    %% ۱. انتخاب ویژگی (Feature Selection) - بر اساس هیت‌مپ
    % در تحلیل دیدیم که فشار خون و ضخامت پوست رابطه کمی با بیماری دارند.
    % حذف آن‌ها باعث می‌شود نویز کمتر شود و مدل روی قند و انسولین تمرکز کند.
    
    weakFeatures = {'BloodPressure', 'SkinThickness'};
```
**خط ۷-۱۱:** 
- `%%` یک سکشن جدید در متلب ایجاد می‌کند.
- یک آرایه سلولی شامل نام ستون‌هایی که می‌خواهیم حذف کنیم ساخته می‌شود.

```matlab
    data = removevars(data, weakFeatures);
```
**خط ۱۲:** ستون‌های `BloodPressure` و `SkinThickness` از جدول حذف می‌شوند.

```matlab
    fprintf('✅ ویژگی‌های ضعیف حذف شدند: %s\n', strjoin(weakFeatures, ', '));
```
**خط ۱۴:** پیغام موفقیت نمایش می‌دهد. `strjoin` نام‌های ستون‌ها را با کاما به هم می‌چسباند.

```matlab
    %% ۲. مدیریت داده‌های نامعتبر (Imputation) - بر اساس باکس‌پلات
    % ستون‌هایی که هنوز ممکن است صفر داشته باشند (به جز آنهایی که حذف کردیم)
    colsToClean = {'Glucose', 'Insulin', 'BMI'};
```
**خط ۱۶-۱۸:** لیست ستون‌هایی که باید تمیز شوند تعریف می‌شود.

```matlab
    for i = 1:length(colsToClean)
```
**خط ۲۰:** یک حلقه شروع می‌شود که برای هر ستون در لیست `colsToClean` اجرا می‌شود.

```matlab
        colName = colsToClean{i};
```
**خط ۲۱:** نام ستون فعلی در متغیر `colName` ذخیره می‌شود. `{i}` یعنی عنصر iام آرایه سلولی.

```matlab
        colData = data.(colName);
```
**خط ۲۲:** داده‌های ستون فعلی از جدول استخراج می‌شوند. `data.(colName)` یعنی "ستون با نام colName از جدول data".

```matlab
        % تبدیل ۰ به NaN
        colData(colData == 0) = NaN;
```
**خط ۲۴-۲۵:** 
- `colData == 0` یک آرایه منطقی می‌سازد که در هر خانه که مقدار ۰ است، `true` و در بقیه `false` است.
- `colData(...) = NaN` همه صفرها را به `NaN` (Not a Number) تبدیل می‌کند تا متلب بفهمد اینجا داده نداریم.

```matlab
        % تغییر مهم: استفاده از میانه (Median) به جای میانگین (Mean)
        % چرا؟ چون در نمودار BoxPlot داده‌های پرت زیادی دیدیم.
        % میانگین به شدت تحت تاثیر داده پرت است، اما میانه مقاوم است.
        fillVal = median(colData, 'omitnan');
```
**خط ۲۷-۳۰:** 
- میانه ستون محاسبه می‌شود (نه میانگین).
- `'omitnan'` یعنی مقادیر `NaN` را نادیده بگیر.
- میانه مقاوم‌تر از میانگین است و تحت تاثیر داده‌های پرت قرار نمی‌گیرد.

```matlab
        colData(isnan(colData)) = fillVal;
```
**خط ۳۲:** همه جاهایی که `NaN` است با مقدار میانه (`fillVal`) جایگزین می‌شود.

```matlab
        data.(colName) = colData;
```
**خط ۳۳:** ستون اصلاح شده دوباره در جدول اصلی ذخیره می‌شود.

```matlab
    end
```
**خط ۳۴:** پایان حلقه `for`.

```matlab
    disp('✅ مقادیر صفر با "میانه" (Median) جایگزین شدند (مقاوم در برابر داده پرت).');
```
**خط ۳۵:** پیغام موفقیت نمایش می‌دهد.

```matlab
    %% ۳. جدا کردن ویژگی‌ها و هدف
    % ستون Outcome هدف است
    X = data{:, 1:end-1};
```
**خط ۳۷-۳۹:** 
- `data{:, 1:end-1}` یعنی همه سطرها (`:`) و همه ستون‌ها به جز آخرین (`1:end-1`).
- این یعنی همه ویژگی‌ها (بدون ستون `Outcome`).

```matlab
    Y = data{:, end};
```
**خط ۴۰:** `data{:, end}` یعنی همه سطرها و فقط ستون آخر (`end`). این همان ستون `Outcome` است.

```matlab
    %% ۴. نرمال‌سازی (Normalization)
    % استانداردسازی (Z-Score) برای هم‌وزن کردن انسولین و سن
    X = normalize(X);
```
**خط ۴۲-۴۴:** 
- `normalize(X)` همه ستون‌ها را نرمال می‌کند (تبدیل به Z-Score).
- نتیجه: همه ویژگی‌ها در یک مقیاس قرار می‌گیرند (میانگین ۰ و انحراف معیار ۱).

```matlab
    disp('✅ داده‌ها نرمال‌سازی شدند.');
```
**خط ۴۵:** پیغام موفقیت.

```matlab
    %% ۵. تقسیم داده‌ها
    % استفاده از HoldOut (70% آموزش - 30% تست)
    % تنظیم seed برای اینکه نتایج هر بار عوض نشود (قابل تکرار باشد)
    rng(42);
```
**خط ۴۷-۵۰:** 
- `rng(42)` seed مولد اعداد تصادفی را روی ۴۲ تنظیم می‌کند.
- این باعث می‌شود هر بار که برنامه را اجرا می‌کنیم، تقسیم‌بندی یکسان باشد.

```matlab
    cv = cvpartition(Y, 'HoldOut', 0.3);
```
**خط ۵۱:** 
- `cvpartition` یک تقسیم‌بندی تصادفی می‌سازد.
- `'HoldOut', 0.3` یعنی ۳۰٪ داده‌ها برای تست کنار بگذار.
- `cv` یک شیء است که می‌گوید کدام سطرها برای آموزش و کدام برای تست هستند.

```matlab
    X_train = X(training(cv), :);
```
**خط ۵۳:** 
- `training(cv)` اندیس‌های سطرهایی که برای آموزش انتخاب شده‌اند را برمی‌گرداند.
- `X(..., :)` یعنی فقط سطرهای انتخاب شده و همه ستون‌ها.

```matlab
    Y_train = Y(training(cv), :);
```
**خط ۵۴:** برچسب‌های مربوط به داده‌های آموزشی.

```matlab
    X_test = X(test(cv), :);
```
**خط ۵۶:** داده‌های تست.

```matlab
    Y_test = Y(test(cv), :);
```
**خط ۵۷:** برچسب‌های مربوط به داده‌های تست.

```matlab
    fprintf('✅ تقسیم‌بندی نهایی: %d آموزش، %d تست.\n', length(Y_train), length(Y_test));
```
**خط ۵۹:** پیغام نهایی که تعداد نمونه‌های آموزش و تست را نمایش می‌دهد.

```matlab
end
```
**خط ۶۰:** پایان تابع.

---

## تصویر ساده در ذهن

- اول، ویژگی‌های ضعیف حذف می‌شوند.  
- بعد، داده‌های اشتباه (صفرهای غیرمنطقی) را با میانه جایگزین می‌کند.  
- سپس، ستون «جواب درست» را از بقیه‌ی ستون‌ها جدا می‌کند.  
- بعد، همه‌ی ستون‌ها را هم‌مقیاس می‌کند تا مدل گیج نشود.  
- و در نهایت، داده‌ها را به دو بخش «برای یادگیری» و «برای امتحان گرفتن» تقسیم می‌کند.
