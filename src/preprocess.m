function [X_train, Y_train, X_test, Y_test] = preprocess(data)
    % PREPROCESS ูุณุฎู ุญุฑููโุง (Smart Version)
    % ุจุฑ ุงุณุงุณ ูุชุงุฌ ุชุญูู ุฏุงุฏูโูุง (EDA)
    
    disp('-----------------------------------------');
    disp('๐งน ูุฑุญูู ณ: ูพุดโูพุฑุฏุงุฒุด ููุดููุฏ ุฏุงุฏูโูุง');
    disp('-----------------------------------------');
    
    disp('... ุฏุฑ ุญุงู ูพุดโูพุฑุฏุงุฒุด ููุดููุฏ (Smart Preprocessing) ...');

    %% ฑ. ุงูุชุฎุงุจ ูฺฺฏ (Feature Selection) - ุจุฑ ุงุณุงุณ ูุชโููพ
    % ุฏุฑ ุชุญูู ุฏุฏู ฺฉู ูุดุงุฑ ุฎูู ู ุถุฎุงูุช ูพูุณุช ุฑุงุจุทู ฺฉู ุจุง ุจูุงุฑ ุฏุงุฑูุฏ.
    % ุญุฐู ุขูโูุง ุจุงุนุซ ูโุดูุฏ ููุฒ ฺฉูุชุฑ ุดูุฏ ู ูุฏู ุฑู ููุฏ ู ุงูุณููู ุชูุฑฺฉุฒ ฺฉูุฏ.
    
    weakFeatures = {'BloodPressure', 'SkinThickness'};
    data = removevars(data, weakFeatures);
    
    fprintf('โ ูฺฺฏโูุง ุถุนู ุญุฐู ุดุฏูุฏ: %s\n', strjoin(weakFeatures, ', '));

    %% ฒ. ูุฏุฑุช ุฏุงุฏูโูุง ูุงูุนุชุจุฑ (Imputation) - ุจุฑ ุงุณุงุณ ุจุงฺฉุณโูพูุงุช
    % ุณุชููโูุง ฺฉู ูููุฒ ููฺฉู ุงุณุช ุตูุฑ ุฏุงุดุชู ุจุงุดูุฏ (ุจู ุฌุฒ ุขููุง ฺฉู ุญุฐู ฺฉุฑุฏู)
    colsToClean = {'Glucose', 'Insulin', 'BMI'};
    
    for i = 1:length(colsToClean)
        colName = colsToClean{i};
        colData = data.(colName);
        
        % ุชุจุฏู ฐ ุจู NaN
        colData(colData == 0) = NaN;
        
        % ุชุบุฑ ููู: ุงุณุชูุงุฏู ุงุฒ ูุงูู (Median) ุจู ุฌุง ูุงูฺฏู (Mean)
        % ฺุฑุงุ ฺูู ุฏุฑ ูููุฏุงุฑ BoxPlot ุฏุงุฏูโูุง ูพุฑุช ุฒุงุฏ ุฏุฏู.
        % ูุงูฺฏู ุจู ุดุฏุช ุชุญุช ุชุงุซุฑ ุฏุงุฏู ูพุฑุช ุงุณุชุ ุงูุง ูุงูู ููุงูู ุงุณุช.
        fillVal = median(colData, 'omitnan');
        
        colData(isnan(colData)) = fillVal;
        data.(colName) = colData;
    end
    disp('โ ููุงุฏุฑ ุตูุฑ ุจุง "ูุงูู" (Median) ุฌุงฺฏุฒู ุดุฏูุฏ (ููุงูู ุฏุฑ ุจุฑุงุจุฑ ุฏุงุฏู ูพุฑุช).');

    %% ณ. ุฌุฏุง ฺฉุฑุฏู ูฺฺฏโูุง ู ูุฏู
    % ุณุชูู Outcome ูุฏู ุงุณุช
    X = data{:, 1:end-1}; 
    Y = data{:, end};

    %% ด. ูุฑูุงูโุณุงุฒ (Normalization)
    % ุงุณุชุงูุฏุงุฑุฏุณุงุฒ (Z-Score) ุจุฑุง ููโูุฒู ฺฉุฑุฏู ุงูุณููู ู ุณู
    X = normalize(X);
    disp('โ ุฏุงุฏูโูุง ูุฑูุงูโุณุงุฒ ุดุฏูุฏ.');

    %% ต. ุชูุณู ุฏุงุฏูโูุง
    % ุงุณุชูุงุฏู ุงุฒ HoldOut (70% ุขููุฒุด - 30% ุชุณุช)
    % ุชูุธู seed ุจุฑุง ุงูฺฉู ูุชุงุฌ ูุฑ ุจุงุฑ ุนูุถ ูุดูุฏ (ูุงุจู ุชฺฉุฑุงุฑ ุจุงุดุฏ)
    rng(42); 
    cv = cvpartition(Y, 'HoldOut', 0.3);
    
    X_train = X(training(cv), :);
    Y_train = Y(training(cv), :);
    
    X_test = X(test(cv), :);
    Y_test = Y(test(cv), :);
    
    fprintf('โ ุชูุณูโุจูุฏ ููุง: %d ุขููุฒุดุ %d ุชุณุช.\n', length(Y_train), length(Y_test));
end